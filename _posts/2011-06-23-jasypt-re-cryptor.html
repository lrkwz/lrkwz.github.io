---
layout: post
title: jasypt re-cryptor
date: '2011-06-23T12:58:00.000+02:00'
author: Luca Orlandi
tags:
- hibernate
- spring
- crypting
modified_time: '2011-09-14T22:14:43.317+02:00'
blogger_id: tag:blogger.com,1999:blog-5600070.post-2476434983659199351
blogger_orig_url: http://lrkwz.blogspot.com/2011/06/jasypt-re-cryptor.html
---

Mi trovo a dovere applicare la crittazione ad un&nbsp; database già esistente, purtroppo non ho potuto optare per una soluzione sistemistica (tipo le oracle crypting option) quindi ho ripiegato su una soluzione 100% applicativa.<br /><br />L'ottima libreria jasypt si "inietta" tra lo strato applicativo vero e proprio e&nbsp; hibernate in modo da rendere il processo di (de)crittazione trasparente dal punto di vista applicativo:<br />dopo avere configurato i bean a supporto del crypting è sufficiente aggiungere un paio di annotazioni alle proprietà delle classi di dominio che devoo essere "protette" ed il gioco è fatto!<br />i problemi sorgono quando questo intervento deve essere fatto su un database di produzione già popolato ... per risolvere la questione uno degli approcci possibili consiste nel definire un semplice wrapper della classe PBEStringEncryptor che non fa altro che delegare e a fronte della eccezione EncryptionOperationNotPossibleException restituire il dato originale:<br /><br /><pre class="brush: java">import org.jasypt.encryption.pbe.PBEStringEncryptor;<br />import org.jasypt.exceptions.EncryptionOperationNotPossibleException;<br /><br />public class RecryptingPooledPBEStringREncryptor implements PBEStringEncryptor {<br />&nbsp;&nbsp;&nbsp; private PBEStringEncryptor firstEncryptor;<br /><br />&nbsp;&nbsp;&nbsp; @Override<br />&nbsp;&nbsp;&nbsp; public String encrypt(String message) {<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return firstEncryptor.encrypt(message);<br />&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp; @Override<br />&nbsp;&nbsp;&nbsp; public String decrypt(String encryptedMessage) {<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; try {<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return firstEncryptor.decrypt(encryptedMessage);<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; } catch (EncryptionOperationNotPossibleException e) {<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return encryptedMessage;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp; @Override<br />&nbsp;&nbsp;&nbsp; public void setPassword(String password) {<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; firstEncryptor.setPassword(password);<br />&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp; /**<br />&nbsp;&nbsp;&nbsp; &nbsp;* @return the firstEncryptor<br />&nbsp;&nbsp;&nbsp; &nbsp;*/<br />&nbsp;&nbsp;&nbsp; public PBEStringEncryptor getFirstEncryptor() {<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return firstEncryptor;<br />&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp; /**<br />&nbsp;&nbsp;&nbsp; &nbsp;* @param firstEncryptor<br />&nbsp;&nbsp;&nbsp; &nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; the firstEncryptor to set<br />&nbsp;&nbsp;&nbsp; &nbsp;*/<br />&nbsp;&nbsp;&nbsp; public void setFirstEncryptor(PBEStringEncryptor firstEncryptor) {<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; this.firstEncryptor = firstEncryptor;<br />&nbsp;&nbsp;&nbsp; }<br />}<br /></pre><br />Questo bean può essere dichiarato nell'applicationContext.xml attorno allo stringencryptor vero e proprio:<br /><br /><pre class="brush: xml">&lt;bean id="strongEncryptor"<br />  class="it.more.encryption.pbe.RecryptingPooledPBEStringREncryptor"&gt;<br />  &lt;property name="firstEncryptor"&gt;<br />   &lt;bean id="pbeStringEncryptor" class="org.jasypt.encryption.pbe.PooledPBEStringEncryptor"&gt;<br />    &lt;property name="algorithm"&gt;<br />     &lt;value&gt;PBEWITHSHA256AND128BITAES-CBC-BC&lt;/value&gt;<br />    &lt;/property&gt;<br />    &lt;property name="password"&gt;<br />     &lt;value&gt;jasypt&lt;/value&gt;<br />    &lt;/property&gt;<br />    &lt;property name="poolSize"&gt;<br />     &lt;value&gt;4&lt;/value&gt;<br />    &lt;/property&gt;<br />    &lt;property name="provider" ref="bouncyProvider"&gt;&lt;/property&gt;<br />    &lt;property name="saltGenerator"&gt;<br />     &lt;bean class="org.jasypt.salt.ZeroSaltGenerator" /&gt;<br />    &lt;/property&gt;<br />   &lt;/bean&gt;<br />  &lt;/property&gt;<br /> &lt;/bean&gt;&nbsp;</pre><pre class="brush: xml">&nbsp;</pre><br />PS: Thank you to <a href="http://www.craftyfella.com/2010/01/syntax-highlighting-with-blogger-engine.html">Craftyfella</a> for the nice code <a href="http://alexgorbatchev.com/SyntaxHighlighter/">snippet highlighter</a> and the <a href="http://www.opinionatedgeek.com/dotnet/tools/htmlencode/encode.aspx">quick encoding tool</a>.<br />