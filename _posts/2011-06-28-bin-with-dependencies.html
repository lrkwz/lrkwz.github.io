---
layout: post
title: bin-with-dependencies
date: '2011-06-28T00:57:00.002+02:00'
author: Luca Orlandi
tags:
- Tech
- maven
modified_time: '2011-12-03T22:06:50.700+01:00'
blogger_id: tag:blogger.com,1999:blog-5600070.post-7015702880320078461
blogger_orig_url: http://lrkwz.blogspot.com/2011/06/bin-with-dependencies.html
---

Mi sono trovato a dovere costruire una applicazione java da eseguire da command line appoggiata su un modulo java spring-based.<br />Dopo avere fatto diversi tentativi ho&nbsp; scelto di utilizzare <a href="https://github.com/sazzer/spring-cli">sazzer</a>.<br />Tra i compiti di questo applicativo c'è la codifica di alcune informazioni operazione per la quale ho scelto di utsare jasypt e la lireria bouncycastle.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://t2.gstatic.com/images?q=tbn:ANd9GcQkVQrXXXlJTJKwmGCUIxgqHpPe0kHK0b_Zg1Cmk3bI29GoXrJ8" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" src="http://t2.gstatic.com/images?q=tbn:ANd9GcQkVQrXXXlJTJKwmGCUIxgqHpPe0kHK0b_Zg1Cmk3bI29GoXrJ8" /></a></div>Quando mi sono trovato a <b>pacchettizzare </b>il tutto ovviamente o pensato di sfruttare il maven-assembly-plugin con il descrittore di default <a href="http://maven.apache.org/plugins/maven-assembly-plugin/descriptor-refs.html#jar-with-dependencies">jar-with-dependencies</a> (qesto come è noto produce un jar contenenti tutte le classi delle dipendenze indicate nel pom.xml).<br />Il primo problema che ho dovuto affrontare è legato ad un bug del maven-assembly-plugin che compromette i file META-ING/spring.handlers e META-INF/spring.schemas impedendo l'esecuzione del jar prodotto (ammetto di avere prodotto i miei <i>a mano</i> senza usufruire del <a href="http://maven.apache.org/plugins/maven-shade-plugin/examples/resource-transformers.html">maven-shade-plugin</a>).<br /><br />Purtroppo il jar così prodotto <b>non è eseguibile</b> in quanto la firma contenuta all'interno della libreria bouncycastle non è valida per il mio artifact!<br /><br />Infine mi sono risolto per copiare tutte le dipendenze assieme al mio jar ed allegare uno script per eseguire la mia applicazione mettendo nel classpath i jar delle dipendenze.<br /><br />Per completare il tutto ho configurato il maven-assembly-plugin in modo da produrre un file zip (bz2 o gz) contentente il mio jar, le liberie e lo script<br /><br /><pre class="brush: xml">&lt;assembly xmlns="http://maven.apache.org/plugins/maven-assembly-plugin/assembly/1.1.0" <br />&nbsp;&nbsp;&nbsp; xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br />&nbsp;&nbsp;&nbsp; xsi:schemaLocation="http://maven.apache.org/plugins/maven-assembly-plugin/assembly/1.1.0 http://maven.apache.org/xsd/assembly-1.1.0.xsd"&gt;<br />&nbsp;&nbsp;&nbsp; &lt;id&gt;bin&lt;/id&gt;<br />&nbsp;&nbsp;&nbsp; &lt;formats&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;format&gt;tar.gz&lt;/format&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;format&gt;tar.bz2&lt;/format&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;format&gt;zip&lt;/format&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/formats&gt;<br />&nbsp;&nbsp;&nbsp; &lt;fileSets&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;fileSet&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;directory&gt;${project.basedir}&lt;/directory&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;outputDirectory&gt;/&lt;/outputDirectory&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;includes&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;include&gt;README*&lt;/include&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;include&gt;LICENSE*&lt;/include&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;include&gt;NOTICE*&lt;/include&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/includes&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/fileSet&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;fileSet&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;directory&gt;${project.build.directory}/classes/META-INF&lt;/directory&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;outputDirectory&gt;/&lt;/outputDirectory&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;includes&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;include&gt;*.sh&lt;/include&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;include&gt;*.bat&lt;/include&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/includes&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/fileSet&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;fileSet&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;directory&gt;${project.build.directory}&lt;/directory&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;outputDirectory&gt;/&lt;/outputDirectory&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;includes&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;include&gt;**/*.jar&lt;/include&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/includes&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/fileSet&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;fileSet&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;directory&gt;${project.build.directory}/site&lt;/directory&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;outputDirectory&gt;docs&lt;/outputDirectory&gt;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/fileSet&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/fileSets&gt;<br />&lt;/assembly&gt;<br /></pre><br />kkk